# AWS EKS 集群纳管教程

## 概述

K8M支持纳管AWS EKS（Elastic Kubernetes Service）集群，让您可以通过统一的界面管理多个云上的Kubernetes集群。本教程将指导您如何在K8M中添加和管理AWS EKS集群。

## 前置条件

### 1. AWS 账户和权限要求

在开始之前，请确保您具备以下条件：

- 有效的AWS账户
- 具有EKS集群访问权限的IAM用户
- 已创建的EKS集群

### 2. 必需的AWS权限

您的AWS IAM用户需要具备以下权限：

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "eks:DescribeCluster",
                "eks:ListClusters",
                "eks:DescribeNodegroup",
                "eks:ListNodegroups"
            ],
            "Resource": "*"
        }
    ]
}
```

### 3. 获取AWS访问凭证

您需要准备以下信息：
- **Access Key ID**: AWS访问密钥ID
- **Secret Access Key**: AWS访问密钥
- **Region**: EKS集群所在的AWS区域
- **Cluster Name**: EKS集群名称

## 操作步骤

![输入图片说明](https://foruda.gitee.com/images/1756647083741011439/510a7946_77493.png "屏幕截图")

### 步骤1：进入集群管理页面

1. 登录K8M系统
2. 在左侧导航栏中，点击 **"平台设置"** (如图中标记①)
3. 选择 **"多集群管理"** (如图中标记②)

### 步骤2：开始添加EKS集群

在集群管理页面：

1. 点击页面上方的 **"纳管AWS EKS集群"** 按钮 (如图中标记③)
2. 系统将打开"纳管AWS EKS集群"对话框

### 步骤3：填写AWS配置信息

在弹出的配置对话框中（如图中标记④），请按顺序填写以下信息：

#### 3.1 AWS凭证信息

- **Access Key**: 
  - 输入您的AWS Access Key ID
  - 这是AWS为您生成的访问密钥标识符
  - 示例格式：`AKIAIOSFODNN7EXAMPLE`

- **Secret Key**:
  - 输入您的AWS Secret Access Key
  - 这是与Access Key配对的密钥
  - 注意：此字段会被加密存储，确保安全性

#### 3.2 区域和集群信息

- **AWS 区域**:
  - 从下拉菜单中选择EKS集群所在的AWS区域
  - 支持的区域包括：
    - 美国东部（弗吉尼亚北部） - us-east-1
    - 美国西部（俄勒冈） - us-west-2
    - 亚太地区（新加坡） - ap-southeast-1
    - 亚太地区（东京） - ap-northeast-1
    - 欧洲（爱尔兰） - eu-west-1
    - 等其他AWS区域

- **集群名称**:
  - 输入您要纳管的EKS集群名称
  - 必须是AWS中实际存在的集群名称
  - 系统会验证集群是否存在且可访问

- **显示名称**:
  - 为集群设置一个友好的显示名称（可选）
  - 如果不填写，将使用集群名称作为显示名称
  - 这个名称将在K8M界面中显示

### 步骤4：确认添加

1. 仔细检查所有填写的信息是否正确
2. 点击 **"确认"** 按钮 (如图中标记⑤) 完成添加
3. 如需取消操作，点击 **"取消"** 按钮

## 验证集群连接

添加成功后，您可以通过以下方式验证集群连接：

![输入图片说明](https://foruda.gitee.com/images/1756647821717254442/1b9ca7f3_77493.png "屏幕截图")

### 1. 检查集群状态

在集群列表中，您应该能看到：
- 集群显示为 **"连接"** 状态
- 集群类型显示为 **"AWS"**
- 可以正常执行 **"断开"** 和 **"授权"** 操作

### 2. 访问集群资源

点击集群名称进入集群详情，您应该能够：
- 查看节点信息
- 浏览命名空间
- 管理工作负载
- 查看服务和网络资源

## 常见问题解决

### 1. 凭证验证失败

**问题**：提示Access Key或Secret Key无效

**解决方案**：
- 确认AWS凭证是否正确
- 检查IAM用户是否具有必要的EKS权限
- 验证凭证是否已过期

### 2. 集群连接超时

**问题**：无法连接到EKS集群

**解决方案**：
- 确认集群名称和区域是否正确
- 检查集群是否处于运行状态
- 验证网络连接是否正常

### 3. 权限不足

**问题**：可以连接但无法查看资源

**解决方案**：
- 检查EKS集群的RBAC配置
- 确认IAM用户是否有足够的集群访问权限
- 验证集群的aws-auth ConfigMap配置

## 安全注意事项

1. **凭证安全**：
   - AWS凭证将被加密存储在K8M数据库中
   - 建议定期轮换AWS访问密钥
   - 使用最小权限原则配置IAM用户

2. **网络安全**：
   - 确保K8M服务器与AWS的网络连接安全
   - 考虑使用VPN或专用网络连接

3. **审计日志**：
   - K8M会记录所有集群操作日志
   - 定期检查操作日志以确保安全性

## 后续操作

成功纳管EKS集群后，您可以：

- 在K8M中统一管理多个EKS集群
- 使用AI功能进行集群诊断和运维
- 通过Helm管理应用部署
- 设置集群监控和告警
- 配置用户权限和访问控制

## 总结

通过本教程，您已经学会了如何在K8M中纳管AWS EKS集群。这使您能够在统一的界面中管理云上的Kubernetes集群，提高运维效率。

如果在操作过程中遇到问题，请参考常见问题解决部分，或联系技术支持获取帮助。